<?php

namespace Chess\Tests\Unit;

use Chess\FenToBoardFactory;
use Chess\SanSignal;
use Chess\Tests\AbstractUnitTestCase;
use Chess\Variant\Classical\Board;

class SanSignalTest extends AbstractUnitTestCase
{
    public function phi_start()
    {
        $expected = 3362626364;

        $board = new Board();

        $phi = SanSignal::phi($board);

        $this->assertEquals($expected, $phi);
    }

    public function phi_kaufman_06()
    {
        $expected = 1938861923;

        $board = FenToBoardFactory::create('r5k1/3n1ppp/1p6/3p1p2/3P1B2/r3P2P/PR3PP1/2R3K1 b - -');

        $phi = SanSignal::phi($board);

        $this->assertEquals($expected, $phi);
    }

    /**
     * @test
     */
    public function decode_A74()
    {
        $expected = '1.d4 Nf6 2.c4 c5 3.d5 e6 4.Nc3 exd5 5.cxd5 d6 6.e4 g6 7.Nf3 Bg7 8.Be2 O-O 9.O-O a6 10.a4';

        $phi = [ 0, 3530412349, 2532887542, 3682245942, 1091364578, 797883169, 4263999068, 1954069693, 184339593, 833351396, 837113606, 2941659443, 435177712, 3142879859, 3065508635, 3834767935, 1073257767, 2732156664, 3777063103, 716798583 ];

        $board = SanSignal::decode(new Board(), $phi);

        $this->assertEquals($expected, $board->movetext());
    }

    /**
     * @test
     */
    public function decode_B33()
    {
        $expected = '1.e4 c5 2.Nf3 Nc6 3.d4 cxd4 4.Nxd4 Nf6 5.Nc3 d6 6.Be2 e5 7.Nf3 h6 8.h3 Be6 9.O-O Be7 10.Re1 Rc8 11.Bf1 Nb8 12.Nd5 Nxd5 13.exd5 Bf5 14.c4 O-O 15.Qa4 a5 16.a3 Bd7 17.Qd1 a4 18.b4 axb3 19.Qxb3 Na6 20.Be3 Qc7 21.a4 Nc5 22.Bxc5 Qxc5 23.Qxb7 Rc7 24.Qb3 Ra8 25.Nd2 f5 26.Nb1 Bh4 27.g3 Bf6 28.Nc3 e4 29.Ra2 Qa5 30.Rc1 Be5 31.Rcc2 Rc5 32.Nb5 Kh8 33.Qe3 Qb4 34.Nd4 Rcc8 35.Ne6 Rxa4 36.Rxa4 Qxa4 37.Rd2 Qa1 38.Kg2 Rb8 39.Nf4 Rb1 40.Qe2 Re1 41.Ra2 Rxe2 42.Rxa1 Rxf2+ 43.Kxf2 Bxa1 44.Ke3 Kg8 45.Ne6 g6 46.c5 Be5 47.g4 Bxe6 48.dxe6 d5 49.gxf5 gxf5 50.Bb5 Kf8 51.Bc6 d4+ 52.Kd2 Bf4+ 53.Kc2 d3+ 54.Kc3 Be3 55.Kc4 Ke7 56.Kd5 Bxc5 57.Bb5 Bd6 58.Bc4 Bc7 59.Bb5 Kf6 60.h4 Bg3 61.h5 Bc7';

        $phi = [ 0, 2792297990, 1347607459, 3298259197, 3742911510, 2837191598, 4248861491, 3305348941, 2160700567, 3594681829, 825662132, 1296058896, 3793955362, 3338362575, 887612202, 13552300, 39088416, 1386644889, 3064642899, 374825265, 2223664497, 2564616023, 448638237, 1418129877, 2041251958, 1929462629, 3511623992, 1838725130, 294042864, 3646048304, 146308268, 293730065, 4106864780, 3006456948, 3817621803, 2915758824, 2092871642, 2446327746, 2321720604, 2140348509, 4064796747, 3407513887, 2452639465, 2707445173, 2393518252, 39920490, 2854066618, 3822150588, 2683268895, 2537592472, 3204850981, 2506166904, 1749713497, 3469829793, 334326963, 2239579855, 1953891428, 3721023837, 724368502, 467321257, 593255536, 325944633, 1523229289, 1895964458, 4209362060, 1156124700, 553709902, 2771898863, 3475430875, 2387197603, 1425752377, 1499075088, 4023204485, 2512688701, 2875297424, 611082179, 2986891991, 553640993, 728946957, 3526099007, 3267191575, 2523371801, 3285249127, 1865735945, 3479491440, 1191877225, 3532183581, 880384705, 1356232208, 1002188695, 2306904615, 1381901281, 1240430753, 1216604650, 1732256826, 2555925183, 37810969, 2695694708, 442224506, 3271984074, 3132398145, 1587406087, 2976232000, 1400102181, 4161350598, 2264725687, 1125106861, 181707254, 3893659729, 1715794977, 1446952989, 133014211, 4100204346, 3181778561, 2979634120, 2192387508, 3630251836, 3948251456, 2731309688, 494942900, 3290913676, 3631602987, 652200250 ];

        $board = SanSignal::decode(new Board(), $phi);

        $this->assertEquals($expected, $board->movetext());
    }
}
